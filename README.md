[<img src=https://user-images.githubusercontent.com/6883670/31999264-976dfb86-b98a-11e7-9432-0316345a72ea.png height=75 />](https://reactome.org)

## WikidataExport

This is the sister code of the [r-wikidata-bot](https://github.com/reactome/r-wikidata-bot) and creates the required csv files from the Reactome Graph Database.

## Code

The code is written in Java and uses the [Graph Database](http://www.reactome.org/pages/documentation/developer-guide/graph-database/) and corresponding API. 


### Arguments

The following arguments are required

```console
-h "host"      The neo4j host for the ReactomeDB
-b "port"      The neo4j port
-u "user"      The neoj4 username
-p "password"  The neo4j password
-o "outdir"    The directory where output files will be written
```


### Output

Four csv files are written:
- hsa\_pathway\_data.csv
- hsa\_reaction\_data.csv
- hsa\_entity\_data.csv
- hsa\_modprot\_data.csv


These files are read in by the sister code r-wikidata-bot and used to populate/update wikidata entries.


## Limitations

Currently the code only supports the Homo sapiens species. This is hard coded at present but commented out code will facilitate adding other species in the future.
Polymers and Chemical Drugs are not yet supported by Wikidata and export of these does not yet happen.


---

## RELEASE

### PREREQUISITES


1. You must have [Reactome Graph Database](http://www.reactome.org/dev/graph-database/) up and running before executing the wikidata-exporter
2. You must have Python v3 with [WikidataIntegrator](https://github.com/SuLab/WikidataIntegrator) installed before executing the r-wikidata-bot

#### STEP ONE: Export from Reactome

**NOTE: You made need to update the pom.xml file in the wikidata-exporter project if the graph-core has moved beyond version 1.1.10**

1. Cloning and packaging the wikidata-exporter project

```console
git clone https://github.com/reactome/wikidata-exporter.git
cd wikidata-exporter
mvn clean package
```

2. Generating .csv files

```console
mkdir outputdir
java -jar target/wikidata-exporter-jar-with-dependencies.jar -h localhost -b 7474 -u user -p not4share -outdir outputdir
```

This step may take up to 10 minutes.

3. Verification

Check that the outputdir has the 4 csv files mentioned above.

Inspect the file wikidata-exporter/WikidataExporter.log. Files in the wikidata-exporter/dev directory expand on what errors or warnings might be issued and how to deal with them.

NOTE: If there are only warnings it is safe to proceed without correcting them.

4. Change directory

```console
cd ..
```

#### STEP TWO: Import to Wikidata

1. Clone the r-wikidata-bot project

```console
git clone https://github.com/reactome/r-wikidata-bot.git
cd r-wikidata-bot
```

2. Move the .csv files

```console
mkdir inputdir
cp ../wikidata-exporter/outputdir/*.csv ./inputdir/*
```

3. Update the release_info.txt file

This file contains the specifics of *this* release in a format that the code expects. Do NOT change the format, merely change the data. See [r-wikidata-bot/dev/release_info.md](https://github.com/reactome/r-wikidata-bot/blob/master/dev/release_info.md)




4. Run the import

Note: This bot should only be run under the 'Pathwaybot' wikidata account.

```console
python update_wikidata.py
```


***Note: This may take several hours. Maybe as much as 10-12 hours - I'm not joking!***


5. Verification

Inspect file r-wikidata-bot/logs/WD_bot_run_TIMESTAMP.log. This is the log file generated by interactions with wikidata. It logs any issue as an error but the only one that is a major problem is an http timeout. This would suggest the process needs to be re-run.

Inspect the four csv files in the r-wikidata-bot/logs directory. These list entries that could not be linked. See [r-wikidata-bot/dev/missing_info.md](https://github.com/reactome/r-wikidata-bot/blob/master/dev/missing_info.md) for details on where to report particular issues.

Check that https://www.wikidata.org/wiki/Q2134522 contains the publication date of this release with the correct reference.

Randomly check entries made - see the csv log files.



